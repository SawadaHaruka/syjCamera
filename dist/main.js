(()=>{"use strict";var e={d:(t,c)=>{for(var r in c)e.o(c,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:c[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{Q:()=>je});class t{constructor(){const e=document.querySelector(".hamburger"),t=document.querySelector(".menu");let c=!0;e.addEventListener("click",(()=>{e.classList.toggle("active"),t.classList.toggle("open"),!0===c?(document.addEventListener("touchmove",r,{passive:!1}),document.body.classList.add("overflow-hidden"),c=!1):!1===c&&(document.removeEventListener("touchmove",r,{passive:!1}),document.body.classList.remove("overflow-hidden"),c=!0)}));const r=e=>{e.preventDefault()}}}const c=gsap.fromTo(".stamp_btn",{y:15,opacity:0},{paused:!0,duration:1.2,y:0,opacity:1,ease:"power2.out",stagger:{from:"start",amount:.8}}),r=document.querySelectorAll(".stamp_btn");r.forEach((e=>{e.addEventListener("mouseover",(()=>{e.style.transform="scale(0.9)"})),e.addEventListener("mouseout",(()=>{e.style.transform="scale(1)"}))}));class a extends createjs.Bitmap{constructor(e){super(e),this.regX=160,this.regY=240}initStamp(e,t,c,r){this.x=e,this.y=t,this.scale=c,this.rotation=r}}const n=new class extends a{constructor(){super("../src/img/img_stamp/katsura1.png")}},i=new class extends a{constructor(){super("../src/img/img_stamp/katsura2.png")}},s=new class extends a{constructor(){super("../src/img/img_stamp/katsura3.png"),this.regX=180}},d=new class extends a{constructor(){super("../src/img/img_stamp/katsura4.png")}},o=new class extends a{constructor(){super("../src/img/img_stamp/katsura5.png"),this.regY=280}},l=new class extends a{constructor(){super("../src/img/img_stamp/katsura6.png")}},h=new class extends a{constructor(){super("../src/img/img_stamp/katsura7.png"),this.regY=230}},u=new class extends a{constructor(){super("../src/img/img_stamp/katsura8.png")}},g=new class extends a{constructor(){super("../src/img/img_stamp/katsura9.png"),this.regY=230}},m=new class extends a{constructor(){super("../src/img/img_stamp/katsura10.png"),this.regX=180,this.regY=280}},v=new class extends a{constructor(){super("../src/img/img_stamp/katsura11.png")}},w=new class extends a{constructor(){super("../src/img/img_stamp/katsura12.png"),this.regY=230}},p=[n,i,s,d,o,l,h,u,g,m,v,w],b=document.querySelector("#btn_k1"),k=document.querySelector("#btn_k2"),y=document.querySelector("#btn_k3"),S=document.querySelector("#btn_k4"),_=document.querySelector("#btn_k5"),E=document.querySelector("#btn_k6"),L=document.querySelector("#btn_k7"),q=document.querySelector("#btn_k8"),C=document.querySelector("#btn_k9"),f=document.querySelector("#btn_k10"),M=document.querySelector("#btn_k11"),T=document.querySelector("#btn_k12"),x=[b,k,y,S,_,E,L,q,C,f,M,T],I=()=>{p.forEach((e=>{je.removeChild(e)}))};b.addEventListener("click",(()=>{I(),je.addChild(n)})),k.addEventListener("click",(()=>{I(),je.addChild(i)})),y.addEventListener("click",(()=>{I(),je.addChild(s)})),S.addEventListener("click",(()=>{I(),je.addChild(d)})),_.addEventListener("click",(()=>{I(),je.addChild(o)})),E.addEventListener("click",(()=>{I(),je.addChild(l)})),L.addEventListener("click",(()=>{I(),je.addChild(h)})),q.addEventListener("click",(()=>{I(),je.addChild(u)})),C.addEventListener("click",(()=>{I(),je.addChild(g)})),f.addEventListener("click",(()=>{I(),je.addChild(m)})),M.addEventListener("click",(()=>{I(),je.addChild(v)})),T.addEventListener("click",(()=>{I(),je.addChild(w)}));const j=(e,t,c)=>{if(!(t.r>e.r||e.r>c.r||t.g>e.g||e.g>c.g||t.b>e.b||e.b>c.b))return!0},R=new createjs.Bitmap("../src/img/img_material/maskTex.png"),H=()=>{let e=new createjs.Stage("canvas_light"),t=new createjs.Bitmap(canvas_light);R.cache(0,0,500,500);let c=new createjs.AlphaMaskFilter(R.cacheCanvas);t.filters=[c],t.cache(-50,-50,500,500),e.addChild(t),e.update()},D=()=>{let e=new createjs.Stage("canvas_dark"),t=new createjs.Bitmap(canvas_dark);R.cache(0,0,500,500);let c=new createjs.AlphaMaskFilter(R.cacheCanvas);t.filters=[c],t.cache(-50,-50,500,500),e.addChild(t),e.update()},B=document.querySelector("#canvas_bg"),O=B.getContext("2d"),A=document.querySelector("#bg1"),Y=document.querySelector("#bg2"),F=document.querySelector("#bg3"),P=document.querySelector("#bg4"),U=document.querySelector("#bg5"),X=document.querySelector("#bg6"),N=document.querySelector("#btn_bg1"),G=document.querySelector("#btn_bg2"),V=document.querySelector("#btn_bg3"),z=document.querySelector("#btn_bg4"),K=document.querySelector("#btn_bg5"),Q=document.querySelector("#btn_bg6"),W=[N,G,V,z,K,Q],J={value:"img1"};N.addEventListener("click",(()=>{J.value="img1"})),G.addEventListener("click",(()=>{J.value="img2"})),V.addEventListener("click",(()=>{J.value="img3"})),z.addEventListener("click",(()=>{J.value="img4"})),K.addEventListener("click",(()=>{J.value="img5"})),Q.addEventListener("click",(()=>{J.value="img6"}));const Z=e=>{document.querySelectorAll("#icons_bg img").forEach((e=>{e.style.backgroundColor="#a38a64"})),e.style.backgroundColor="#0dabb7"},$=(e,t)=>{let c=(e=>{let t=new cv.Mat;return cv.cvtColor(e,t,cv.COLOR_RGBA2GRAY,0),t})(e),r=new cv.Size(t,t),a=new cv.Mat;return cv.GaussianBlur(c,a,r,0,0,cv.BORDER_DEFAULT),a};class ee extends createjs.Shape{constructor(){super()}set_cheek(e,t,c,r){this.graphics.beginFill(r).drawCircle(0,0,e),this.x=t,this.y=c,this.alpha=.6;let a=new createjs.BlurFilter(20,20,1);R.cache(0,0,500,500);let n=new createjs.AlphaMaskFilter(R.cacheCanvas);this.filters=[a,n],this.cache(-50,-50,400,400)}}class te extends ee{constructor(){super()}}const ce=document.querySelector("#btn_c1"),re=document.querySelector("#btn_c2"),ae=document.querySelector("#btn_c3"),ne=document.querySelector("#btn_c4"),ie=document.querySelector("#btn_c5"),se=document.querySelector("#btn_c6"),de=[ce,re,ae,ne,ie,se],oe={value:"img1"};ce.addEventListener("click",(()=>{oe.value="img1"})),re.addEventListener("click",(()=>{oe.value="img2"})),ae.addEventListener("click",(()=>{oe.value="img3"})),ne.addEventListener("click",(()=>{oe.value="img4"})),ie.addEventListener("click",(()=>{oe.value="img5"})),se.addEventListener("click",(()=>{oe.value="img6"}));const le=e=>{document.querySelectorAll("#icons_cheekColor img").forEach((e=>{e.style.backgroundColor="#a38a64"})),e.style.backgroundColor="#0dabb7"};let he;class ue extends createjs.Bitmap{constructor(e){super(e),this.regX=110,this.regY=0}initHige(e,t,c,r){this.x=e,this.y=t,this.scale=c,this.rotation=r}}const ge=new class extends ue{constructor(){super("../src/img/img_higeStamp/hige1.png"),this.regY=90}},me=new class extends ue{constructor(){super("../src/img/img_higeStamp/hige2.png"),this.regX=290}},ve=new class extends ue{constructor(){super("../src/img/img_higeStamp/hige3.png"),this.regX=140}},we=new class extends ue{constructor(){super("../src/img/img_higeStamp/hige4.png")}},pe=new class extends ue{constructor(){super("../src/img/img_higeStamp/hige5.png")}},be=new class extends ue{constructor(){super("../src/img/img_higeStamp/hige6.png"),this.regX=160}},ke=[ge,me,ve,we,pe,be],ye=()=>{ke.forEach((e=>{Se.removeChild(e)}))},Se=new createjs.Stage("canvasHige"),_e=document.querySelector("#btn_h1"),Ee=document.querySelector("#btn_h2"),Le=document.querySelector("#btn_h3"),qe=document.querySelector("#btn_h4"),Ce=document.querySelector("#btn_h5"),fe=document.querySelector("#btn_h6"),Me=[_e,Ee,Le,qe,Ce,fe],Te={value:"img1"};_e.addEventListener("click",(()=>{Te.value="img1"})),Ee.addEventListener("click",(()=>{Te.value="img2"})),Le.addEventListener("click",(()=>{Te.value="img3"})),qe.addEventListener("click",(()=>{Te.value="img4"})),Ce.addEventListener("click",(()=>{Te.value="img5"})),fe.addEventListener("click",(()=>{Te.value="img6"}));const xe=e=>{document.querySelectorAll("#icons_hige img").forEach((e=>{e.style.backgroundColor="#a38a64"})),e.style.backgroundColor="#0dabb7"},Ie=e=>{let t=URL.createObjectURL(e),c=document.createElement("a");document.body.appendChild(c),c.download=(()=>{let e=new Date;return"icon"+e.getMonth()+1+e.getDate()+"_"+e.getHours()+e.getMinutes()+e.getSeconds()+".png"})(),c.href=t,c.click(),c.remove(),setTimeout((()=>{URL.revokeObjectURL(t)}),2e3)},je=new createjs.Stage("canvasStamp");new class{constructor(){document.addEventListener("DOMContentLoaded",this.init(),!1)}init(){console.log("DOMContentLoaded"),new t;let e="wait";const a=document.querySelector("#log"),n=document.querySelector("#count_log_ver"),i=document.querySelector("#count_log"),s=document.querySelector("#progress_log"),d=document.querySelector("#progress_img"),o=document.querySelector("#video"),l=document.querySelector("#overlay_canvas"),h=l.getContext("2d"),u=document.querySelector("#canvasStamp"),g=document.querySelector("#canvasStamp_color"),m=g.getContext("2d"),v=document.querySelector("#canvasB"),w=v.getContext("2d"),b=document.querySelector("#wireframe_canvasB"),k=b.getContext("2d"),y=document.querySelector("#canvasA"),S=y.getContext("2d"),_=document.querySelector("#dataOnly_canvas500"),E=_.getContext("2d",{alpha:!1}),L=document.querySelector("#dataOnly_canvas375"),q=L.getContext("2d",{alpha:!1}),C=document.querySelector("#btnB"),f=document.querySelector("#btnA"),M=document.querySelector("#canvasHige"),T=document.querySelector("#canvas_light"),I=T.getContext("2d"),R=document.querySelector("#canvas_dark"),ue=R.getContext("2d"),Re=document.querySelector("#canvas_cheek"),He=document.querySelector("#canvas_line"),De=He.getContext("2d"),Be=document.querySelector("#bar_light"),Oe=document.querySelector("#color_light"),Ae=document.querySelector("#bar_dark"),Ye=document.querySelector("#bar_lineThick"),Fe=document.querySelector("#bar_lineThreshold");let Pe=120,Ue=60,Xe=1,Ne=80;const Ge=document.querySelector("#btn_dl");let Ve=document.querySelector("#dl_canvas");const ze=Ve.getContext("2d");window.addEventListener("load",(()=>{let t,Ke;console.log("windowLoaded");let Qe=document.documentElement.clientWidth,We=document.documentElement.clientHeight,Je="";setTimeout((()=>{window.scrollTo({top:0})}),300),We>=1.2*Qe&&Qe>=600||We>=1.4*Qe&&Qe<600?(Je="tab_sp",console.log("iPadかスマホの縦画面ですね"),t=400,o.width=o.height=l.width=u.width=g.width=M.width=M.height=l.height=u.height=g.height=t,navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:t,height:t},audio:!1}).then((e=>{o.srcObject=e})),v.width=b.width=y.width=v.height=b.height=y.height=300):(Je="pc",console.log("パソコンorスマホ/タブレットの横画面ですね。"),t=500,Ke=375,o.width=t,o.height=375,l.width=u.width=g.width=M.width=t,l.height=u.height=g.height=M.height=375,navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:t,height:375},audio:!1}).then((e=>{o.srcObject=e})),v.width=b.width=y.width=400,v.height=b.height=y.height=300,_.width=500,_.height=375),T.width=T.height=B.width=B.height=R.width=R.height=Re.width=Re.height=He.width=He.height=375;const Ze=new clm.tracker;Ze.init(pModel),createjs.Ticker.addEventListener("tick",je);const $e=new createjs.Stage("canvas_cheek"),et=document.querySelector("#start_triger");let tt;et.addEventListener("click",(()=>{e="start",o.play(),createjs.Ticker.addEventListener("tick",ct),Ze.start(o),et.style.display="none",C.style.display="block",d.style.visibility="visible",s.innerHTML="緑の線が顔についてくるか確認しよう！<br>前髪を分けると認識されやすいよ"}));const ct=()=>{createjs.Ticker.addEventListener("tick",ct),tt=Ze.getCurrentPosition(),h.clearRect(0,0,l.width,l.height),Ze.draw(l),m.clearRect(0,0,g.width,g.height),m.drawImage(u,0,0,g.width,g.height),tt&&Et(tt)},rt=()=>{let e=.55*(st-ot)/-110,t=180*Math.atan2(lt-dt,ot-st)/Math.PI;p.forEach((c=>{c.initStamp(ht,ut,e,t)}));const c={r:null,g:null,b:null};let r=m.getImageData(0,0,g.width,g.height),a=r.data;for(let e=0,t=r.data.length;e<t;e+=4)c.r=a[e],c.g=a[e+1],c.b=a[e+2],j(c,Vt,zt)&&(a[e]=jt,a[e+1]=Rt,a[e+2]=Ht);m.putImageData(r,0,0)};let at,nt,it,st,dt,ot,lt,ht,ut,gt,mt,vt,wt,pt,bt,kt,yt,St,_t;x.forEach((t=>{t.addEventListener("click",(()=>{e="autoShutter",a.innerHTML="【三】変顔を5秒以上しよう。",n.innerHTML="自力で撮影バージョン",i.innerHTML="撮影まで<br>"}))}));const Et=t=>{ht=t[33][0],ut=t[33][1];let c=e=>Math.abs(Math.sqrt((ht-t[e][0])**2+(ut-t[e][1])**2)),r=c(16),a=c(20),n=c(18),i=c(22),s=c(29),d=c(24),o=c(31),l=c(26),h=c(62),u=c(50),g=c(44),m=c(57),v=c(60),w=c(6),p=c(8),b=c(11),k=c(3),y=()=>{"tab_sp"==Je?(pt=Math.abs(t[40][0]-t[13][0])/2+375*t[40][0]/400,bt=Math.abs(t[40][1]-t[13][1])/2+375*t[13][1]/400,kt=Math.abs(t[34][0]-t[1][0])/2+375*t[1][0]/400,yt=Math.abs(t[34][1]-t[1][1])/2+375*t[1][1]/400):"pc"==Je&&(pt=Math.abs(t[40][0]-t[13][0])/2+t[40][0]-62.5,bt=Math.abs(t[40][1]-t[13][1])/2+t[13][1],kt=Math.abs(t[34][0]-t[1][0])/2+t[1][0]-62.5,yt=Math.abs(t[34][1]-t[1][1])/2+t[1][1])};const S=()=>{St=t[37][0],_t=t[37][1]};if(st=t[0][0],dt=t[0][1],ot=t[14][0],lt=t[14][1],wt=Math.abs(Math.sqrt((st-ot)**2+(dt-lt)**2)),"before"===e)at=[],at=[r,a,n,i,s,d,o,l,h,u,g,m,v,w,p,b,k],gt=Math.abs(Math.sqrt((st-ot)**2+(dt-lt)**2));else if("autoShutter"===e){rt(),nt=[],it=[],nt=[r,a,n,i,s,d,o,l,h,u,g,m,v,w,p,b,k],mt=Math.abs(Math.sqrt((st-ot)**2+(dt-lt)**2)),vt=mt/gt;let e=nt.map((e=>e/vt));for(let t=0;t<nt.length;t++){let c=e[t]/at[t];c<1&&(c=2-c),it.push(c)}it.reduce(((e,t)=>e+t),0)>=nt.length+.8?(qt=!0,ft>=Ct&&(clearTimeout(Lt),y(),S(),Xt())):qt=!1}else"usingButton"==e&&(rt(),clearTimeout(Lt),y(),S(),Xt())};let Lt,qt=null,Ct=6,ft=0;const Mt=()=>{if(1==qt){ft++;let e=Ct-ft;i.innerHTML="撮影まで<br>"+e}else 0==qt&&(ft=0,i.innerHTML="撮影まで<br>");Lt=setTimeout(Mt,1e3)};let Tt,xt,It,jt,Rt,Ht,Dt,Bt,Ot;const At=()=>{if(console.log("トラッキング成功"),Ft(),C.style.display="none",setTimeout((()=>{Pt()}),1200),Mt(),c.play(),tt=Ze.getCurrentPosition(),tt){Et(tt),k.clearRect(0,0,b.width,b.height),Ze.stop(o),Ze.draw(b);let t=Math.round(tt[1][0]),c=Math.round(tt[1][1]),n=Math.round(tt[13][0]);const i=w.getImageData(t,c,n-t,1),d=i.data;Dt=[],Bt=[],Ot=[];for(let e=0;e<i.width*i.height*4;e+=4)Tt=d[e],xt=d[e+1],It=d[e+2],Dt.push(Tt),Bt.push(xt),Ot.push(It);let l=Dt.reduce(((e,t)=>e+t),0);jt=l/Dt.length;let h=Bt.reduce(((e,t)=>e+t),0);Rt=h/Bt.length;let u=Ot.reduce(((e,t)=>e+t),0);Ht=u/Ot.length,e="selectKatsura",a.innerHTML="【二】かつらを選んでね。",s.innerHTML="全力で変顔をしてみよう。<br>大きく顔を変化させられれば自動で撮影カウントが始まるよォ",r.forEach((e=>{e.style.display="inline-block"})),setTimeout((()=>{"autoShutter"==e&&(s.innerHTML="なかなか撮れてないみたいだね。大変！<br>このボタンを押してみると良いよ。すぐ撮影できるゾ",f.style.display="inline-block")}),3e4)}},Yt=()=>{a.innerHTML="トラッキング失敗、もう一度撮影してください",Ft(),setTimeout((()=>{Pt()}),1200)},Ft=()=>{document.removeEventListener("clmtrackrConverged",At,!1),document.removeEventListener("clmtrackrNotFound",Yt,!1),document.removeEventListener("clmtrackrLost",Yt,!1)},Pt=()=>{Ze.stop(v),Ze.reset(),Ze.start(o)};C.addEventListener("click",(()=>{e="before",w.clearRect(0,0,v.width,v.height),w.drawImage(o,0,0,v.width,v.height),k.clearRect(0,0,b.width,b.height),Ze.reset(),Ze.start(v),document.addEventListener("clmtrackrConverged",At,!1),document.addEventListener("clmtrackrNotFound",Yt,!1),document.addEventListener("clmtrackrLost",Yt,!1)}));const Ut=()=>{q.clearRect(0,0,L.width,L.height),q.drawImage(_,62.5,0,L.width,L.height,0,0,L.width,L.height),We>=1.2*Qe&&q.drawImage(y,0,0,L.width,L.height)},Xt=()=>{S.clearRect(0,0,y.width,y.height),S.drawImage(o,0,0,y.width,y.height),S.drawImage(g,0,0,y.width,y.height),E.clearRect(0,0,_.width,_.height),E.drawImage(y,0,0,_.width,_.height),E.drawImage(g,0,0,_.width,_.height),Ut(),Ze.stop(o),createjs.Ticker.removeEventListener("tick",ct),createjs.Ticker.removeEventListener("tick",je),o.pause(),e="end",a.innerHTML="【四】撮影完了！",s.innerHTML="撮影完了！<br>いい感じに編集をしてアイコンを作ろう",lc(),window.scrollTo(0,document.documentElement.scrollHeight-We)};f.addEventListener("click",(()=>{e="usingButton",n.innerHTML="ボタンで撮影バージョン",qt=!0})),document.addEventListener("visibilitychange",(()=>{if("visible"===document.visibilityState)switch(e){case"end":o.pause(),createjs.Ticker.removeEventListener("tick",ct),Ze.stop();break;case"wait":o.pause();break;default:o.play(),createjs.Ticker.addEventListener("tick",ct),Ze.start(o)}else"hidden"===document.visibilityState&&(o.pause(),createjs.Ticker.removeEventListener("tick",ct),Ze.stop())}));const Nt={r:0,g:0,b:0},Gt={r:4,g:4,b:4},Vt={r:248,g:248,b:248},zt={r:255,g:255,b:255};let Kt={};W.forEach((e=>{e.addEventListener("click",(()=>{lc()}))}));const Qt=()=>{O.globalCompositeOperation="source-over",O.clearRect(0,0,B.width,B.height),O.drawImage(T,0,0,B.width,B.height),O.drawImage(R,0,0,B.width,B.height),O.drawImage(Re,0,0,B.width,B.height),O.globalCompositeOperation="multiply",(()=>{switch(J.value){case"img1":return O.drawImage(A,0,0,B.width,B.height),void Z(N);case"img2":return O.drawImage(Y,0,0,B.width,B.height),void Z(G);case"img3":return O.drawImage(F,0,0,B.width,B.height),void Z(V);case"img4":return O.drawImage(P,0,0,B.width,B.height),void Z(z);case"img5":return O.drawImage(U,0,0,B.width,B.height),void Z(K);case"img6":O.drawImage(X,0,0,B.width,B.height),Z(Q)}})()};let Wt=250,Jt=230,Zt=220;const $t=()=>{I.clearRect(0,0,T.width,T.height);let e=cv.imread(L),t=((e,t)=>{let c=$(e,3),r=new cv.Mat;return cv.threshold(c,r,t,255,cv.THRESH_BINARY),r})(e,Pe);cv.imshow("canvas_light",t),e.delete(),t.delete();const c=I.getImageData(0,0,T.width,T.height),r=c.data;for(let e=0,t=r.length;e<t;e+=4)Kt.r=r[e],Kt.g=r[e+1],Kt.b=r[e+2],j(Kt,Nt,Gt)&&(r[e]=Wt,r[e+1]=Jt,r[e+2]=Zt,r[e+3]=255);I.putImageData(c,0,0),H(),Qt()};Oe.addEventListener("change",(()=>{let e=Oe.value;Wt=parseInt(e.substr(1,2),16),Jt=parseInt(e.substr(3,2),16),Zt=parseInt(e.substr(5,2),16),$t()})),Be.addEventListener("input",(()=>{Pe=Be.value-0,$t()}));const ec=()=>{ue.clearRect(0,0,R.width,R.height);let e=cv.imread(L),t=((e,t)=>{let c=$(e,3),r=new cv.Mat;return cv.threshold(c,r,t,255,cv.THRESH_BINARY),r})(e,Ue);cv.imshow("canvas_dark",t),e.delete(),t.delete();const c=ue.getImageData(0,0,R.width,R.height),r=c.data;for(let e=0,t=r.length;e<t;e+=4)Kt.r=r[e],Kt.g=r[e+1],Kt.b=r[e+2],j(Kt,Vt,zt)&&(r[e+3]=0),j(Kt,Nt,Gt)&&(r[e]=60,r[e+1]=60,r[e+2]=80,r[e+3]=255);ue.putImageData(c,0,0),D(),Qt()};Ae.addEventListener("input",(()=>{Ue=Ae.value-0,ec()}));const tc=new ee,cc=new te,rc=()=>{let e=25*wt/150;(()=>{switch(oe.value){case"img1":he="#ef89b2",le(ce);break;case"img2":he="#cc0000",le(re);break;case"img3":he="#d14bb4",le(ae);break;case"img4":he="#fca88e",le(ne);break;case"img5":he="#ff6600",le(ie);break;case"img6":he="#cc00ff",le(se)}})(),tc.set_cheek(e,pt,bt,he),cc.set_cheek(e,kt,yt,he),$e.addChild(tc,cc),$e.update(),Qt()},ac=document.querySelector("#toggle_cheek");ac.checked=!1;const nc=document.querySelectorAll("#icons_cheekColor li");nc.forEach((e=>{e.style.display="none"})),ac.addEventListener("change",(()=>{1==ac.checked?(nc.forEach((e=>{e.style.display="inline-block"})),rc(),de.forEach((e=>{e.addEventListener("click",(()=>{rc()}))}))):0==ac.checked&&(nc.forEach((e=>{e.style.display="none"})),$e.removeChild(tc,cc),$e.update(),Qt())}));const ic=document.querySelector("#toggle_hige");ic.checked=!1;const sc=document.querySelectorAll("#icons_hige li");sc.forEach((e=>{e.style.display="none"})),ic.addEventListener("change",(()=>{1==ic.checked?(sc.forEach((e=>{e.style.display="inline-block"})),dc(),Me.forEach((e=>{e.addEventListener("click",(()=>{dc()}))}))):0==ic.checked&&(sc.forEach((e=>{e.style.display="none"})),ye(),Ut(),lc())}));const dc=()=>{(()=>{let e=.55*wt/110,t=180*Math.atan2(lt-dt,ot-st)/Math.PI;ke.forEach((c=>{c.initHige(St,_t,e,t)}))})(),(()=>{switch(Te.value){case"img1":ye(),Se.addChild(ge),xe(_e);break;case"img2":ye(),Se.addChild(me),xe(Ee);break;case"img3":ye(),Se.addChild(ve),xe(Le);break;case"img4":ye(),Se.addChild(we),xe(qe);break;case"img5":ye(),Se.addChild(pe),xe(Ce);break;case"img6":ye(),Se.addChild(be),xe(fe)}Se.update()})(),Ut(),q.drawImage(M,0,0,L.width,L.height),lc()},oc=()=>{De.clearRect(0,0,He.width,He.height);let e=cv.imread(L),t=((e,t,c)=>{let r=((e,t)=>{let c=$(e,5),r=new cv.Mat;cv.Canny(c,r,t,85,3);let a=new cv.Mat;return cv.bitwise_not(r,a),r.delete(),a})(e,t),a=new cv.Mat,n=cv.Mat.ones(c,c,cv.CV_8U);return cv.erode(r,a,n,new cv.Point(-1,-1),1,cv.BORDER_CONSTANT,cv.morphologyDefaultBorderValue()),n.delete(),a})(e,Ne,Xe);cv.imshow("canvas_line",t),e.delete(),t.delete();const c=De.getImageData(0,0,He.width,He.height),r=c.data;for(let e=0,t=r.length;e<t;e+=4)Kt.r=r[e],Kt.g=r[e+1],Kt.b=r[e+2],j(Kt,Vt,zt)&&(r[e+3]=0),j(Kt,Nt,Gt)&&(r[e]=60,r[e+1]=60,r[e+2]=70,r[e+3]=255);De.putImageData(c,0,0)};Ye.addEventListener("input",(()=>{Xe=Ye.value-0,oc()})),Fe.addEventListener("input",(()=>{Ne=Fe.value-0,oc()}));const lc=()=>{$t(),ec(),oc()};Ge.addEventListener("click",(()=>{ze.drawImage(T,0,0,Ve.width,Ve.height),ze.drawImage(R,0,0,Ve.width,Ve.height),ze.drawImage(B,0,0,Ve.width,Ve.height),ze.drawImage(He,0,0,Ve.width,Ve.height),Ve.toBlob(Ie)})),ct()}))}}})();